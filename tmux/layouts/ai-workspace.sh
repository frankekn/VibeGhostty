#!/usr/bin/env bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AI Workspace Layout for Tmux
# Created for Frank Yang - VibeGhostty Project
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# Layout Design:
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚   Codex CLI (ä¸»è¦)      â”‚  Claude     â”‚
# â”‚   70%                   â”‚  Code       â”‚
# â”‚                         â”‚  30%        â”‚
# â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚                         â”‚ Monitor     â”‚
# â”‚                         â”‚ (Tests/Logs)â”‚
# â”‚                         â”‚  30%        â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
# Usage:
#   ./ai-workspace.sh [project_dir]
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set -e  # é‡åˆ°éŒ¯èª¤ç«‹å³åœæ­¢

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Configuration
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SESSION_NAME="ai-work"
PROJECT_DIR="${1:-$PWD}"

# ç¢ºä¿å°ˆæ¡ˆç›®éŒ„å­˜åœ¨
if [[ ! -d "$PROJECT_DIR" ]]; then
    echo "âŒ éŒ¯èª¤ï¼šå°ˆæ¡ˆç›®éŒ„ä¸å­˜åœ¨ '$PROJECT_DIR'"
    exit 1
fi

# å¦‚æœåœ¨ git repoï¼Œä½¿ç”¨ repo åç¨±ä½œç‚º session åç¨±
if [[ -d "$PROJECT_DIR/.git" ]]; then
    REPO_NAME=$(basename "$PROJECT_DIR")
    SESSION_NAME="ai-${REPO_NAME}"
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Check if session already exists
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

if tmux has-session -t "$SESSION_NAME" 2>/dev/null; then
    echo "ğŸ“Œ Session '$SESSION_NAME' å·²å­˜åœ¨"
    echo "é¸æ“‡æ“ä½œï¼š"
    echo "  1. é€£æ¥åˆ°ç¾æœ‰ session (attach)"
    echo "  2. åˆªé™¤ä¸¦é‡æ–°å»ºç«‹ (recreate)"
    echo "  3. å–æ¶ˆ (cancel)"
    read -p "è«‹é¸æ“‡ [1/2/3]: " choice

    case $choice in
        1)
            echo "ğŸ”— é€£æ¥åˆ° session '$SESSION_NAME'..."
            tmux attach-session -t "$SESSION_NAME"
            exit 0
            ;;
        2)
            echo "ğŸ—‘ï¸  åˆªé™¤ç¾æœ‰ session..."
            tmux kill-session -t "$SESSION_NAME"
            ;;
        3|*)
            echo "âŒ å·²å–æ¶ˆ"
            exit 0
            ;;
    esac
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Create new session
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

echo "ğŸš€ å»ºç«‹ AI Workspace session: $SESSION_NAME"
echo "ğŸ“ å°ˆæ¡ˆç›®éŒ„: $PROJECT_DIR"

# å»ºç«‹ sessionï¼ˆä½†ä¸ç«‹å³ attachï¼‰
tmux new-session -d -s "$SESSION_NAME" -c "$PROJECT_DIR"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Setup Pane 0: Codex CLI (å·¦å´ 70%)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# è¨­å®šæ¨™é¡Œ
tmux select-pane -t "${SESSION_NAME}:0.0" -T "ğŸ”§ Codex CLI"

# å•Ÿå‹• Codex
tmux send-keys -t "${SESSION_NAME}:0.0" "codex" C-m

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Create Pane 1: Claude Code (å³ä¸Š 30%)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# å‚ç›´åˆ†å‰²å³å´ï¼ˆ30% å¯¬åº¦ï¼‰
tmux split-window -h -p 30 -t "$SESSION_NAME:0" -c "$PROJECT_DIR"

# è¨­å®šæ¨™é¡Œ
tmux select-pane -t "${SESSION_NAME}:0.1" -T "ğŸ¤– Claude Code"

# å•Ÿå‹• Claude Code
tmux send-keys -t "${SESSION_NAME}:0.1" "claude" C-m

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Create Pane 2: Monitor (å³ä¸‹ 30%)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# åœ¨å³å´ pane ä¸‹æ–¹å†åˆ†å‰²ï¼ˆ50% é«˜åº¦ï¼‰
tmux split-window -v -p 50 -t "$SESSION_NAME:0.1" -c "$PROJECT_DIR"

# è¨­å®šæ¨™é¡Œ
tmux select-pane -t "${SESSION_NAME}:0.2" -T "ğŸ“Š Monitor"

# é¡¯ç¤ºæç¤ºè¨Šæ¯ï¼ˆä¸è‡ªå‹•åŸ·è¡Œç¨‹å¼ï¼‰
tmux send-keys -t "$SESSION_NAME:0.2" "clear" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo ''" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo 'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo 'â•‘     ğŸ“Š Monitor Pane ä½¿ç”¨èªªæ˜      â•‘'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo 'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo ''" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo 'æ­¤ pane ç”¨æ–¼ç›£æ§å’Œæ—¥èªŒï¼š'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo ''" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo '  ğŸ§ª åŸ·è¡Œæ¸¬è©¦ï¼š'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo '     npm test --watch'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo '     pytest -v --watch'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo ''" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo '  ğŸ“‹ æª¢è¦–æ—¥èªŒï¼š'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo '     tail -f app.log'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo '     docker logs -f container'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo ''" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo '  ğŸ” ç³»çµ±ç›£æ§ï¼š'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo '     htop'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo '     watch -n 1 \"ps aux | grep node\"'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo ''" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo 'ğŸ’¡ æŒ‰ Ctrl+Space ç„¶å¾ŒæŒ‰ 3 å¿«é€Ÿè·³åˆ°é€™è£¡'" C-m
tmux send-keys -t "$SESSION_NAME:0.2" "echo ''" C-m

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Final Setup
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# å›åˆ° Codex CLI paneï¼ˆä¸»å·¥ä½œå€ï¼‰
tmux select-pane -t "${SESSION_NAME}:0.0"

# é€£æ¥åˆ° session
echo "âœ… Session å»ºç«‹å®Œæˆï¼æ­£åœ¨é€£æ¥..."
sleep 1  # çµ¦ä¸€é»æ™‚é–“è®“ CLI å•Ÿå‹•

tmux attach-session -t "$SESSION_NAME"
