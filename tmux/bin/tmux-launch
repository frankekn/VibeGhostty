#!/usr/bin/env bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Tmux AI Workspace Interactive Launcher
# Created for Frank Yang - VibeGhostty Project
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set -e

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Colors for beautiful output
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

BLUE="\033[34m"
CYAN="\033[36m"
GREEN="\033[32m"
YELLOW="\033[33m"
MAGENTA="\033[35m"
RED="\033[31m"
BOLD="\033[1m"
DIM="\033[2m"
RESET="\033[0m"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Configuration
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

LAYOUTS_DIR="$HOME/.tmux-layouts"
PROJECT_DIR="$PWD"

# å¦‚æœæœ‰å®‰è£ fzfï¼Œå¯ä»¥ç”¨ä¾†é¸æ“‡å°ˆæ¡ˆ
HAS_FZF=false
if command -v fzf &> /dev/null; then
    HAS_FZF=true
fi

# å¸ƒå±€è³‡è¨Šè³‡æ–™åº«
declare -A LAYOUT_INFO=(
    ["ai-workspace:name"]="AI Workspace"
    ["ai-workspace:desc"]="ä¸»è¦é–‹ç™¼å¸ƒå±€ï¼Œ70/30 åˆ†å‰²"
    ["ai-workspace:tools"]="Codex CLI (70%) + Claude Code (30%)"
    ["ai-workspace:preview"]="â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”\nâ”‚   Primary       â”‚ Aux  â”‚\nâ”‚   70%           â”‚ 30%  â”‚\nâ”‚                 â”œâ”€â”€â”€â”€â”€â”€â”¤\nâ”‚                 â”‚ Mon. â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜"

    ["ai-compare:name"]="AI Compare"
    ["ai-compare:desc"]="ä¸¦æ’æ¯”è¼ƒå…©å€‹ AI è¼¸å‡º"
    ["ai-compare:tools"]="Codex (50%) + Claude (50%)"
    ["ai-compare:preview"]="â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Codex   â”‚ Claude  â”‚\nâ”‚ 50%     â”‚ 50%     â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Compare/Monitor   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"

    ["full-focus:name"]="Full Focus"
    ["full-focus:desc"]="å…¨å±å°ˆæ³¨æ¨¡å¼ï¼Œæœ€å°å¹²æ“¾"
    ["full-focus:tools"]="Single AI (100%)"
    ["full-focus:preview"]="â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                   â”‚\nâ”‚   Single AI       â”‚\nâ”‚   100%            â”‚\nâ”‚                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
)

# ç’°å¢ƒè®Šæ•¸è³‡è¨Š
declare -A ENV_VARS=(
    ["VIBE_AI_PRIMARY"]="ai-workspace ä¸»è¦å·¥å…· (é è¨­: codex)"
    ["VIBE_AI_SECONDARY"]="ai-workspace è¼”åŠ©å·¥å…· (é è¨­: claude)"
    ["VIBE_AI_LEFT"]="ai-compare å·¦å´å·¥å…· (é è¨­: codex)"
    ["VIBE_AI_RIGHT"]="ai-compare å³å´å·¥å…· (é è¨­: claude)"
    ["VIBE_AI_FOCUS"]="full-focus ä½¿ç”¨çš„å·¥å…· (é è¨­: codex)"
)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Helper Functions
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

show_help() {
    cat << EOF
${BOLD}Tmux AI Workspace Launcher${RESET}

${CYAN}ç”¨æ³•:${RESET}
  tmux-launch [é¸é …] [å¸ƒå±€åç¨±]

${CYAN}é¸é …:${RESET}
  -h, --help              é¡¯ç¤ºæ­¤å¹«åŠ©è¨Šæ¯
  -l, --list              åˆ—å‡ºæ‰€æœ‰å¯ç”¨å¸ƒå±€
  -p, --project <è·¯å¾‘>    æŒ‡å®šå°ˆæ¡ˆç›®éŒ„ï¼ˆé è¨­ï¼šç•¶å‰ç›®éŒ„ï¼‰

${CYAN}å¯ç”¨å¸ƒå±€:${RESET}
  ai-workspace           ä¸»è¦é–‹ç™¼å¸ƒå±€ (70/30 åˆ†å‰²)
  ai-compare             ä¸¦æ’æ¯”è¼ƒå¸ƒå±€ (50/50 åˆ†å‰²)
  full-focus             å…¨å±å°ˆæ³¨æ¨¡å¼ (100% å–®ä¸€å·¥å…·)

${CYAN}ç’°å¢ƒè®Šæ•¸:${RESET}
  VIBE_AI_PRIMARY       ai-workspace ä¸»è¦å·¥å…· (é è¨­: codex)
  VIBE_AI_SECONDARY     ai-workspace è¼”åŠ©å·¥å…· (é è¨­: claude)
  VIBE_AI_LEFT          ai-compare å·¦å´å·¥å…· (é è¨­: codex)
  VIBE_AI_RIGHT         ai-compare å³å´å·¥å…· (é è¨­: claude)
  VIBE_AI_FOCUS         full-focus ä½¿ç”¨çš„å·¥å…· (é è¨­: codex)

${CYAN}ç¯„ä¾‹:${RESET}
  tmux-launch                        # äº’å‹•å¼é¸å–®
  tmux-launch ai-workspace           # ç›´æ¥å•Ÿå‹• AI Workspace
  tmux-launch -p ~/my-project        # æŒ‡å®šå°ˆæ¡ˆç›®éŒ„
  tmux-launch -l                     # åˆ—å‡ºæ‰€æœ‰å¸ƒå±€

${CYAN}è‡ªè¨‚ AI å·¥å…·:${RESET}
  export VIBE_AI_PRIMARY=claude      # å°‡ Claude è¨­ç‚ºä¸»è¦å·¥å…·
  tmux-launch ai-workspace           # ä½¿ç”¨ Claude ä½œç‚ºä¸»å·¥å…·

${DIM}æ›´å¤šè³‡è¨Šè«‹åƒè€ƒ: https://github.com/frankekn/VibeGhostty${RESET}
EOF
}

list_layouts() {
    echo -e "${BOLD}${CYAN}å¯ç”¨å¸ƒå±€:${RESET}\n"

    for layout in "ai-workspace" "ai-compare" "full-focus"; do
        local name="${LAYOUT_INFO[${layout}:name]}"
        local desc="${LAYOUT_INFO[${layout}:desc]}"
        local tools="${LAYOUT_INFO[${layout}:tools]}"
        local preview="${LAYOUT_INFO[${layout}:preview]}"

        echo -e "${GREEN}${BOLD}${layout}${RESET}"
        echo -e "  ${BOLD}åç¨±:${RESET} ${name}"
        echo -e "  ${BOLD}èªªæ˜:${RESET} ${desc}"
        echo -e "  ${BOLD}å·¥å…·:${RESET} ${tools}"
        echo -e "  ${DIM}é è¦½:${RESET}"
        echo -e "${DIM}$(echo -e "$preview" | sed 's/^/    /')${RESET}"
        echo ""
    done

    echo -e "${YELLOW}æç¤º:${RESET} ä½¿ç”¨ ${BOLD}tmux-launch ${GREEN}<å¸ƒå±€åç¨±>${RESET} ç›´æ¥å•Ÿå‹•"
}

verify_layout_script() {
    local layout=$1
    local script="$LAYOUTS_DIR/${layout}.sh"

    # æª¢æŸ¥è…³æœ¬æ˜¯å¦å­˜åœ¨
    if [[ ! -f "$script" ]]; then
        echo -e "${RED}âŒ éŒ¯èª¤: å¸ƒå±€è…³æœ¬ä¸å­˜åœ¨${RESET}"
        echo -e "   è·¯å¾‘: ${DIM}$script${RESET}"
        echo -e "${YELLOW}ğŸ’¡ è§£æ±ºæ–¹æ¡ˆ:${RESET}"
        echo -e "   1. ç¢ºèªå·²åŸ·è¡Œå®‰è£è…³æœ¬: ${BOLD}cd tmux && bash install.sh${RESET}"
        echo -e "   2. æª¢æŸ¥å¸ƒå±€ç›®éŒ„: ${BOLD}ls -la ~/.tmux-layouts/${RESET}"
        return 1
    fi

    # æª¢æŸ¥åŸ·è¡Œæ¬Šé™
    if [[ ! -x "$script" ]]; then
        echo -e "${YELLOW}âš ï¸  è­¦å‘Š: å¸ƒå±€è…³æœ¬ç„¡åŸ·è¡Œæ¬Šé™${RESET}"
        echo -e "   æ­£åœ¨ä¿®å¾©æ¬Šé™..."
        chmod +x "$script"
        if [[ $? -eq 0 ]]; then
            echo -e "${GREEN}âœ… æ¬Šé™å·²ä¿®å¾©${RESET}"
        else
            echo -e "${RED}âŒ ç„¡æ³•ä¿®å¾©æ¬Šé™ï¼Œè«‹æ‰‹å‹•åŸ·è¡Œ:${RESET}"
            echo -e "   ${BOLD}chmod +x $script${RESET}"
            return 1
        fi
    fi

    return 0
}

print_header() {
    clear
    echo -e "${BLUE}${BOLD}"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘                                                           â•‘"
    echo "â•‘          ğŸš€ Tmux AI Workspace Launcher ğŸ¤–                â•‘"
    echo "â•‘                                                           â•‘"
    echo "â•‘              Created for Frank Yang                       â•‘"
    echo "â•‘                                                           â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${RESET}"
    echo ""
}

print_menu() {
    echo -e "${CYAN}${BOLD}â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®${RESET}"
    echo -e "${CYAN}${BOLD}â”‚  Select a workspace layout:                            â”‚${RESET}"
    echo -e "${CYAN}${BOLD}â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯${RESET}"
    echo ""

    # Layout 1: AI Workspace
    echo -e "  ${GREEN}${BOLD}1${RESET} â”‚ ${BOLD}${LAYOUT_INFO["ai-workspace:name"]}${RESET}"
    echo -e "    â”‚ ${DIM}${LAYOUT_INFO["ai-workspace:desc"]}${RESET}"
    echo -e "    â”‚ ${CYAN}å·¥å…·:${RESET} ${LAYOUT_INFO["ai-workspace:tools"]}"
    echo -e "    â”‚ ${DIM}é è¦½:${RESET}"
    echo -e "${DIM}$(echo -e "${LAYOUT_INFO["ai-workspace:preview"]}" | sed 's/^/    â”‚   /')${RESET}"
    echo ""

    # Layout 2: AI Compare
    echo -e "  ${GREEN}${BOLD}2${RESET} â”‚ ${BOLD}${LAYOUT_INFO["ai-compare:name"]}${RESET}"
    echo -e "    â”‚ ${DIM}${LAYOUT_INFO["ai-compare:desc"]}${RESET}"
    echo -e "    â”‚ ${CYAN}å·¥å…·:${RESET} ${LAYOUT_INFO["ai-compare:tools"]}"
    echo -e "    â”‚ ${DIM}é è¦½:${RESET}"
    echo -e "${DIM}$(echo -e "${LAYOUT_INFO["ai-compare:preview"]}" | sed 's/^/    â”‚   /')${RESET}"
    echo ""

    # Layout 3: Full Focus
    echo -e "  ${GREEN}${BOLD}3${RESET} â”‚ ${BOLD}${LAYOUT_INFO["full-focus:name"]}${RESET}"
    echo -e "    â”‚ ${DIM}${LAYOUT_INFO["full-focus:desc"]}${RESET}"
    echo -e "    â”‚ ${CYAN}å·¥å…·:${RESET} ${LAYOUT_INFO["full-focus:tools"]}"
    echo -e "    â”‚ ${DIM}é è¦½:${RESET}"
    echo -e "${DIM}$(echo -e "${LAYOUT_INFO["full-focus:preview"]}" | sed 's/^/    â”‚   /')${RESET}"
    echo ""

    # Option 4: Resume
    echo -e "  ${GREEN}${BOLD}4${RESET} â”‚ ${BOLD}Resume${RESET}"
    echo -e "    â”‚ ${DIM}é€£æ¥åˆ°ç¾æœ‰ tmux session${RESET}"
    echo ""

    # Option 5: Project selector (if fzf available)
    if [[ "$HAS_FZF" == true ]]; then
        echo -e "  ${GREEN}${BOLD}5${RESET} â”‚ ${BOLD}Project Selector${RESET}"
        echo -e "    â”‚ ${DIM}ä½¿ç”¨ fzf é¸æ“‡å°ˆæ¡ˆç›®éŒ„${RESET}"
        echo ""
    fi

    echo -e "  ${RED}${BOLD}q${RESET} â”‚ ${BOLD}Exit${RESET}"
    echo ""

    # Environment variables section
    echo -e "${YELLOW}â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®${RESET}"
    echo -e "${YELLOW}â”‚  ç’°å¢ƒè®Šæ•¸è¨­å®š (å¯è‡ªè¨‚ AI å·¥å…·)                          â”‚${RESET}"
    echo -e "${YELLOW}â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯${RESET}"

    local any_set=false
    for var in "VIBE_AI_PRIMARY" "VIBE_AI_SECONDARY" "VIBE_AI_LEFT" "VIBE_AI_RIGHT" "VIBE_AI_FOCUS"; do
        if [[ -n "${!var}" ]]; then
            echo -e "  ${GREEN}âœ“${RESET} ${BOLD}$var${RESET}=${MAGENTA}${!var}${RESET}"
            any_set=true
        fi
    done

    if [[ "$any_set" == false ]]; then
        echo -e "  ${DIM}æœªè¨­å®š (ä½¿ç”¨é è¨­å€¼)${RESET}"
        echo -e "  ${DIM}æç¤º: export VIBE_AI_PRIMARY=claude å¯è‡ªè¨‚å·¥å…·${RESET}"
    fi
    echo ""

    # Project info
    echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${RESET}"
    echo -e "ğŸ“ ç•¶å‰å°ˆæ¡ˆ: ${MAGENTA}${BOLD}$PROJECT_DIR${RESET}"
    echo -e "${YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${RESET}"
    echo ""
}

list_sessions() {
    echo -e "${CYAN}${BOLD}Existing tmux sessions:${RESET}"
    echo ""

    if tmux list-sessions 2>/dev/null; then
        echo ""
        echo -e "${YELLOW}Enter a session name to attach, or press Enter to go back${RESET}"
        read -p "> " session_name

        if [[ -n "$session_name" ]]; then
            if tmux has-session -t "$session_name" 2>/dev/null; then
                echo "ğŸ”— Attaching to $session_name..."
                tmux attach-session -t "$session_name"
                exit 0
            else
                echo -e "${RED}âŒ Session '$session_name' not found${RESET}"
                sleep 2
            fi
        fi
    else
        echo -e "${YELLOW}âš ï¸  No active sessions${RESET}"
        sleep 2
    fi
}

select_project_with_fzf() {
    echo -e "${CYAN}${BOLD}Select a project directory...${RESET}"
    echo ""

    # æœå°‹å¸¸è¦‹çš„å°ˆæ¡ˆç›®éŒ„
    SEARCH_DIRS=(
        "$HOME/Documents/GitHub"
        "$HOME/Projects"
        "$HOME/Developer"
        "$HOME/Code"
        "$HOME/Work"
    )

    PROJECTS=()
    for dir in "${SEARCH_DIRS[@]}"; do
        if [[ -d "$dir" ]]; then
            while IFS= read -r project; do
                PROJECTS+=("$project")
            done < <(find "$dir" -maxdepth 2 -type d -name ".git" -exec dirname {} \; 2>/dev/null)
        fi
    done

    if [[ ${#PROJECTS[@]} -eq 0 ]]; then
        echo -e "${YELLOW}âš ï¸  No git projects detected${RESET}"
        sleep 2
        return
    fi

    # ä½¿ç”¨ fzf é¸æ“‡
    SELECTED=$(printf '%s\n' "${PROJECTS[@]}" | fzf --height=50% --border --prompt="Select project > " --preview="ls -la {}" --preview-window=right:50%)

    if [[ -n "$SELECTED" ]]; then
        PROJECT_DIR="$SELECTED"
        echo -e "${GREEN}âœ… Selected: $PROJECT_DIR${RESET}"
        sleep 1
    fi
}

launch_layout() {
    local layout=$1
    local script="$LAYOUTS_DIR/${layout}.sh"

    # é©—è­‰å¸ƒå±€è…³æœ¬
    if ! verify_layout_script "$layout"; then
        return 1
    fi

    echo -e "${GREEN}ğŸš€ æ­£åœ¨å•Ÿå‹• ${LAYOUT_INFO[${layout}:name]}...${RESET}"
    sleep 0.5

    bash "$script" "$PROJECT_DIR"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Argument Parsing
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

parse_arguments() {
    while [[ $# -gt 0 ]]; do
        case $1 in
            -h|--help)
                show_help
                exit 0
                ;;
            -l|--list)
                list_layouts
                exit 0
                ;;
            -p|--project)
                if [[ -z "$2" ]]; then
                    echo -e "${RED}âŒ éŒ¯èª¤: -p é¸é …éœ€è¦æŒ‡å®šç›®éŒ„è·¯å¾‘${RESET}"
                    echo -e "ä½¿ç”¨æ–¹æ³•: tmux-launch -p <è·¯å¾‘>"
                    exit 1
                fi
                PROJECT_DIR="$2"
                shift 2
                ;;
            ai-workspace|ai-compare|full-focus)
                # ç›´æ¥å•Ÿå‹•æŒ‡å®šçš„å¸ƒå±€
                if ! verify_layout_script "$1"; then
                    exit 1
                fi
                launch_layout "$1"
                exit 0
                ;;
            -*)
                echo -e "${RED}âŒ æœªçŸ¥é¸é …: $1${RESET}"
                echo -e "ä½¿ç”¨ ${BOLD}tmux-launch --help${RESET} æŸ¥çœ‹å¹«åŠ©"
                exit 1
                ;;
            *)
                echo -e "${RED}âŒ æœªçŸ¥å¸ƒå±€: $1${RESET}"
                echo -e "ä½¿ç”¨ ${BOLD}tmux-launch --list${RESET} æŸ¥çœ‹å¯ç”¨å¸ƒå±€"
                exit 1
                ;;
        esac
    done
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Main Entry Point
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# è§£æå‘½ä»¤åˆ—åƒæ•¸
parse_arguments "$@"

# é©—è­‰å°ˆæ¡ˆç›®éŒ„
if [[ ! -d "$PROJECT_DIR" ]]; then
    echo -e "${RED}âŒ éŒ¯èª¤: å°ˆæ¡ˆç›®éŒ„ä¸å­˜åœ¨${RESET}"
    echo -e "   è·¯å¾‘: ${DIM}$PROJECT_DIR${RESET}"
    exit 1
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Main Interactive Loop
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

while true; do
    print_header
    print_menu

    read -p "Choose [1-4/q]: " choice

    case $choice in
        1)
            launch_layout "ai-workspace"
            exit 0
            ;;
        2)
            launch_layout "ai-compare"
            exit 0
            ;;
        3)
            echo ""
            echo -e "${CYAN}Pick the focus tool:${RESET}"
            echo "  1) Codex CLI (default)"
            echo "  2) Claude Code"
            read -p "Choose [1/2]: " ai_choice

            case $ai_choice in
                2)
                    bash "$LAYOUTS_DIR/full-focus.sh" "$PROJECT_DIR" "claude"
                    ;;
                *)
                    bash "$LAYOUTS_DIR/full-focus.sh" "$PROJECT_DIR" "codex"
                    ;;
            esac
            exit 0
            ;;
        4)
            list_sessions
            ;;
        5)
            if [[ "$HAS_FZF" == true ]]; then
                select_project_with_fzf
            else
                echo -e "${RED}âŒ Invalid option${RESET}"
                sleep 1
            fi
            ;;
        q|Q)
            echo ""
            echo -e "${YELLOW}ğŸ‘‹ Goodbye!${RESET}"
            exit 0
            ;;
        *)
            echo -e "${RED}âŒ Invalid choice, try again${RESET}"
            sleep 1
            ;;
    esac
done
