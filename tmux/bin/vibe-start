#!/usr/bin/env bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# vibe-start - Zero-config tmux + AI workspace launcher
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set -euo pipefail

VERSION="0.1.0"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Helper output
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

print_usage() {
    cat <<'EOF'
Usage: vibe-start [options]

Options:
  -h, --help              Show this help message
      --version           Print version
  -p, --project <path>    Project directory (default: current directory)
      --type <auto|next|node|python>
                          Force project type detection (default: auto)
      --mode <auto|dev|debug|review>
                          Launch preset mode (default: auto)
      --layout <name>     Override layout script (ai-workspace|ai-split|full-focus)
      --detect            Print detection result and exit
      --dry-run           Show plan without launching tmux
      --non-interactive   Assume defaults, never prompt
  -y, --yes               Auto-confirm prompts
EOF
}

log() {
    local level="$1"
    shift
    printf '%s %s\n' "$level" "$*"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Resolve script + layout paths
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

resolve_layout_home() {
    if [[ -d "$HOME/.tmux-layouts" ]]; then
        echo "$HOME/.tmux-layouts"
    else
        echo "$(cd "$SCRIPT_DIR/.." && pwd)/layouts"
    fi
}

LAYOUT_HOME="$(resolve_layout_home)"
LAYOUT_LIB="$LAYOUT_HOME/lib/layout-common.sh"

if [[ ! -f "$LAYOUT_LIB" ]]; then
    log "ERROR" "æ‰¾ä¸åˆ° layout å…±ç”¨å‡½å¼ï¼š$LAYOUT_LIB"
    exit 1
fi

# shellcheck disable=SC1090
source "$LAYOUT_LIB"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# CLI parsing
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PROJECT_DIR="$PWD"
REQUESTED_TYPE="auto"
MODE="auto"
LAYOUT_OVERRIDE=""
DRY_RUN=0
DETECT_ONLY=0
AUTO_YES=0
NON_INTERACTIVE=0

while [[ $# -gt 0 ]]; do
    case "$1" in
        -h|--help)
            print_usage
            exit 0
            ;;
        --version)
            echo "$VERSION"
            exit 0
            ;;
        -p|--project)
            [[ $# -lt 2 ]] && { log "ERROR" "--project éœ€è¦è·¯å¾‘"; exit 1; }
            PROJECT_DIR="$2"
            shift 2
            ;;
        --type)
            [[ $# -lt 2 ]] && { log "ERROR" "--type éœ€è¦å€¼ (auto|next|node|python)"; exit 1; }
            REQUESTED_TYPE="$2"
            shift 2
            ;;
        --mode)
            [[ $# -lt 2 ]] && { log "ERROR" "--mode éœ€è¦å€¼ (auto|dev|debug|review)"; exit 1; }
            MODE="$2"
            shift 2
            ;;
        --layout)
            [[ $# -lt 2 ]] && { log "ERROR" "--layout éœ€è¦åç¨±"; exit 1; }
            LAYOUT_OVERRIDE="$2"
            shift 2
            ;;
        --detect)
            DETECT_ONLY=1
            shift
            ;;
        --dry-run)
            DRY_RUN=1
            shift
            ;;
        --non-interactive)
            NON_INTERACTIVE=1
            AUTO_YES=1
            shift
            ;;
        -y|--yes)
            AUTO_YES=1
            shift
            ;;
        --)
            shift
            break
            ;;
        -*)
            log "ERROR" "æœªçŸ¥åƒæ•¸ï¼š$1"
            exit 1
            ;;
        *)
            PROJECT_DIR="$1"
            shift
            ;;
    esac
done

if [[ "$REQUESTED_TYPE" != "auto" && "$REQUESTED_TYPE" != "next" && "$REQUESTED_TYPE" != "node" && "$REQUESTED_TYPE" != "python" ]]; then
    log "ERROR" "ä¸æ”¯æ´çš„ --type å€¼ï¼š$REQUESTED_TYPE"
    exit 1
fi

if [[ "$MODE" != "auto" && "$MODE" != "dev" && "$MODE" != "debug" && "$MODE" != "review" ]]; then
    log "ERROR" "ä¸æ”¯æ´çš„ --mode å€¼ï¼š$MODE"
    exit 1
fi

PROJECT_DIR="$(vg_resolve_project_dir "$PROJECT_DIR")"
cd "$PROJECT_DIR"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Helpers for detection
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

python_cmd() {
    if command -v python3 &> /dev/null; then
        echo "python3"
    elif command -v python &> /dev/null; then
        echo "python"
    else
        echo ""
    fi
}

package_json_has_script() {
    local script_name="$1"
    [[ -f "$PROJECT_DIR/package.json" ]] || return 1
    local py
    py="$(python_cmd)"
    [[ -n "$py" ]] || return 1
    "$py" - <<'PY' "$PROJECT_DIR/package.json" "$script_name" >/dev/null 2>&1
import json, sys, pathlib
path = pathlib.Path(sys.argv[1])
script = sys.argv[2]
try:
    data = json.loads(path.read_text())
except Exception:
    sys.exit(1)
scripts = data.get("scripts", {})
sys.exit(0 if script in scripts else 1)
PY
}

package_json_has_dependency() {
    local dependency="$1"
    [[ -f "$PROJECT_DIR/package.json" ]] || return 1
    local py
    py="$(python_cmd)"
    [[ -n "$py" ]] || return 1
    "$py" - <<'PY' "$PROJECT_DIR/package.json" "$dependency" >/dev/null 2>&1
import json, sys, pathlib
path = pathlib.Path(sys.argv[1])
target = sys.argv[2]
try:
    data = json.loads(path.read_text())
except Exception:
    sys.exit(1)
for section in ("dependencies", "devDependencies", "peerDependencies", "optionalDependencies"):
    deps = data.get(section, {})
    if isinstance(deps, dict) and target in deps:
        sys.exit(0)
sys.exit(1)
PY
}

detect_package_manager() {
    if [[ -f "$PROJECT_DIR/pnpm-lock.yaml" ]]; then
        echo "pnpm"
    elif [[ -f "$PROJECT_DIR/yarn.lock" ]]; then
        echo "yarn"
    elif [[ -f "$PROJECT_DIR/bun.lockb" ]]; then
        echo "bun"
    else
        echo "npm"
    fi
}

pm_run() {
    local script="$1"
    local pm; pm="$(detect_package_manager)"
    case "$pm" in
        pnpm) echo "pnpm $script" ;;
        yarn) echo "yarn $script" ;;
        bun) echo "bun $script" ;;
        npm|*) echo "npm run $script" ;;
    esac
}

python_main_command() {
    if [[ -f "$PROJECT_DIR/manage.py" ]]; then
        echo "python manage.py runserver"
    elif [[ -f "$PROJECT_DIR/app.py" ]]; then
        echo "python app.py"
    elif [[ -f "$PROJECT_DIR/main.py" ]]; then
        echo "python main.py"
    elif [[ -d "$PROJECT_DIR/src" && -f "$PROJECT_DIR/src/main.py" ]]; then
        echo "python src/main.py"
    else
        echo "python -m http.server 8000"
    fi
}

python_test_command() {
    if command -v pytest &> /dev/null; then
        echo "pytest -f"
    elif command -v nose2 &> /dev/null; then
        echo "nose2 -s"
    else
        echo "echo 'ğŸ” æ²’æœ‰åµæ¸¬åˆ°æ¸¬è©¦æ¡†æ¶ï¼Œè«‹è‡ªè¨‚æŒ‡ä»¤'"
    fi
}

detect_project_type() {
    if [[ "$REQUESTED_TYPE" != "auto" ]]; then
        echo "$REQUESTED_TYPE"
        return
    fi

    if [[ -f "$PROJECT_DIR/package.json" ]]; then
        if package_json_has_dependency "next" || ls "$PROJECT_DIR"/next.config.* >/dev/null 2>&1; then
            echo "next"
            return
        fi
        echo "node"
        return
    fi

    if [[ -f "$PROJECT_DIR/pyproject.toml" || -f "$PROJECT_DIR/requirements.txt" ]]; then
        echo "python"
        return
    fi

    echo "unknown"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Plan construction
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

declare -a PLAN_ENTRIES=()
PLAN_LAYOUT=""
PLAN_DESCRIPTION=""

plan_add() {
    PLAN_ENTRIES+=("$1|$2|$3")
}

build_plan_for_next() {
    PLAN_LAYOUT="${LAYOUT_OVERRIDE:-ai-workspace}"
    PLAN_DESCRIPTION="Next.js workspace"

    local dev_cmd="npm run dev"
    if package_json_has_script "dev"; then
        dev_cmd="$(pm_run dev)"
    elif package_json_has_script "start"; then
        dev_cmd="$(pm_run start)"
    fi

    local test_cmd="echo 'ğŸ§ª ç„¡ test æŒ‡ä»¤ï¼Œè«‹è‡ªè¨‚'"
    if package_json_has_script "test"; then
        test_cmd="$(pm_run test)"
    fi

    plan_add "1.1" "Next.js é–‹ç™¼ä¼ºæœå™¨" "$dev_cmd"
    plan_add "1.2" "ä¸»è¦ AI (${VIBE_AI_PRIMARY:-codex})" "${VIBE_AI_PRIMARY:-codex}"
    plan_add "1.3" "æ¸¬è©¦ / ç›£æ§" "$test_cmd"
}

build_plan_for_node() {
    PLAN_LAYOUT="${LAYOUT_OVERRIDE:-ai-workspace}"
    PLAN_DESCRIPTION="Node.js workspace"

    local main_cmd="node ."
    if package_json_has_script "dev"; then
        main_cmd="$(pm_run dev)"
    elif package_json_has_script "start"; then
        main_cmd="$(pm_run start)"
    fi

    local test_cmd="echo 'ğŸ§ª ç„¡ test æŒ‡ä»¤ï¼Œè«‹è‡ªè¨‚'"
    if package_json_has_script "test"; then
        test_cmd="$(pm_run test)"
    fi

    plan_add "1.1" "Node.js ä¸»æœå‹™" "$main_cmd"
    plan_add "1.2" "ä¸»è¦ AI (${VIBE_AI_PRIMARY:-codex})" "${VIBE_AI_PRIMARY:-codex}"
    plan_add "1.3" "æ¸¬è©¦ / ç›£æ§" "$test_cmd"
}

build_plan_for_python() {
    PLAN_LAYOUT="${LAYOUT_OVERRIDE:-ai-workspace}"
    PLAN_DESCRIPTION="Python workspace"

    local main_cmd; main_cmd="$(python_main_command)"
    local test_cmd; test_cmd="$(python_test_command)"

    plan_add "1.1" "Python æ‡‰ç”¨ç¨‹å¼" "$main_cmd"
    plan_add "1.2" "ä¸»è¦ AI (${VIBE_AI_PRIMARY:-codex})" "${VIBE_AI_PRIMARY:-codex}"
    plan_add "1.3" "æ¸¬è©¦ / ç›£æ§" "$test_cmd"
}

build_plan_for_mode() {
    case "$MODE" in
        dev|auto)
            return 0
            ;;
        debug)
            PLAN_LAYOUT="${LAYOUT_OVERRIDE:-ai-split}"
            PLAN_DESCRIPTION="Debug æ¨¡å¼ï¼ˆAI Splitï¼‰"
            PLAN_ENTRIES=()
            plan_add "1.1" "å·¦å´å·¥å…· (${VIBE_AI_LEFT:-codex})" "${VIBE_AI_LEFT:-codex}"
            plan_add "1.2" "å³å´å·¥å…· (${VIBE_AI_RIGHT:-claude})" "${VIBE_AI_RIGHT:-claude}"
            plan_add "1.3" "æ¯”å° / æ¸¬è©¦" "echo 'ğŸ’¡ åœ¨æ­¤ pane åŸ·è¡Œ diffã€æ¸¬è©¦æˆ–æ—¥èªŒæŒ‡ä»¤'"
            ;;
        review)
            PLAN_LAYOUT="${LAYOUT_OVERRIDE:-ai-split}"
            PLAN_DESCRIPTION="Code Review æ¨¡å¼"
            PLAN_ENTRIES=()
            plan_add "1.1" "Codex Review" "${VIBE_AI_LEFT:-codex}"
            plan_add "1.2" "Claude Review" "${VIBE_AI_RIGHT:-claude}"
            plan_add "1.3" "git diff" "git status && git diff"
            ;;
        *)
            ;;
    esac
}

build_plan() {
    local project_type="$1"

    case "$project_type" in
        next)
            build_plan_for_next
            ;;
        node)
            build_plan_for_node
            ;;
        python)
            build_plan_for_python
            ;;
        *)
            PLAN_LAYOUT="${LAYOUT_OVERRIDE:-ai-workspace}"
            PLAN_DESCRIPTION="é€šç”¨å·¥ä½œå€"
            PLAN_ENTRIES=()
            plan_add "1.1" "Shell" "echo 'ğŸ‘‰ åœ¨æ­¤ pane å•Ÿå‹•æ‚¨çš„æ‡‰ç”¨ç¨‹å¼'"
            plan_add "1.2" "ä¸»è¦ AI (${VIBE_AI_PRIMARY:-codex})" "${VIBE_AI_PRIMARY:-codex}"
            plan_add "1.3" "Notes" "echo 'ğŸ’¡ åœ¨æ­¤ pane è¨˜éŒ„æŒ‡ä»¤æˆ–å•Ÿå‹•æ¸¬è©¦'"
            ;;
    esac

    build_plan_for_mode

    if [[ -n "$LAYOUT_OVERRIDE" ]]; then
        PLAN_LAYOUT="$LAYOUT_OVERRIDE"
    fi
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Validation helpers
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

extract_binary() {
    local cmd="$1"
    local first="${cmd%% *}"
    # handle bun run etc.
    if [[ "$first" == "npm" && "$cmd" == npm\ test* ]]; then
        echo "npm"
        return
    fi
    echo "$first"
}

ensure_dependencies() {
    local missing=0
    for entry in "${PLAN_ENTRIES[@]}"; do
        IFS="|" read -r _ _ command <<< "$entry"
        local bin
        bin="$(extract_binary "$command")"
        [[ -z "$bin" ]] && continue
        case "$bin" in
            echo|clear|git|sleep)
                continue
                ;;
        esac
        if ! command -v "$bin" >/dev/null 2>&1; then
            log "WARN" "æ‰¾ä¸åˆ°æŒ‡ä»¤ï¼š$binï¼ˆå°æ‡‰ pane æŒ‡ä»¤ï¼š$commandï¼‰"
            missing=1
        fi
    done
    return $missing
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Preview / execution
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

print_preview() {
    local project_type="$1"
    echo "ğŸ“ å°ˆæ¡ˆç›®éŒ„: $PROJECT_DIR"
    echo "ğŸ§­ åµæ¸¬é¡å‹: $project_type"
    echo "ğŸ—ºï¸  Layout:  $PLAN_LAYOUT ($PLAN_DESCRIPTION)"
    echo ""
    printf '%-7s %-24s %s\n' "Pane" "èªªæ˜" "æŒ‡ä»¤"
    printf '%-7s %-24s %s\n' "------" "------------------------" "------------------------"
    for entry in "${PLAN_ENTRIES[@]}"; do
        IFS="|" read -r pane label command <<< "$entry"
        printf '%-7s %-24s %s\n' "$pane" "$label" "$command"
    done
    echo ""
}

send_tmux_commands() {
    local session_name="$1"
    for entry in "${PLAN_ENTRIES[@]}"; do
        IFS="|" read -r pane _ command <<< "$entry"
        tmux send-keys -t "${session_name}:${pane}" "clear" C-m
        while IFS= read -r line; do
            [[ -z "$line" ]] && continue
            tmux send-keys -t "${session_name}:${pane}" -- "$line"
            tmux send-keys -t "${session_name}:${pane}" C-m
        done <<< "$command"
    done
}

layout_script_path() {
    local layout="$1"
    local path="$LAYOUT_HOME/${layout}.sh"
    if [[ -x "$path" ]]; then
        echo "$path"
    else
        log "ERROR" "æ‰¾ä¸åˆ°å¸ƒå±€è…³æœ¬ï¼š$path"
        exit 1
    fi
}

layout_session_name() {
    local layout="$1"
    case "$layout" in
        ai-workspace)
            vg_session_name "ai-work" "$PROJECT_DIR" "ai"
            ;;
        ai-split)
            vg_session_name "ai-split" "$PROJECT_DIR" "split"
            ;;
        full-focus)
            vg_session_name "ai-focus" "$PROJECT_DIR" "focus"
            ;;
        *)
            vg_session_name "$layout" "$PROJECT_DIR" "$layout"
            ;;
    esac
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Main execution
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PROJECT_TYPE="$(detect_project_type)"

if [[ "$DETECT_ONLY" -eq 1 ]]; then
    echo "$PROJECT_TYPE"
    exit 0
fi

build_plan "$PROJECT_TYPE"

print_preview "$PROJECT_TYPE"

ensure_dependencies || true

if [[ "$DRY_RUN" -eq 1 ]]; then
    exit 0
fi

if [[ "$AUTO_YES" -ne 1 ]]; then
    read -p "å•Ÿå‹•ä¸Šè¿°å·¥ä½œå€ï¼Ÿ [Y/n]: " answer
    if [[ -n "$answer" && "$answer" =~ ^[Nn]$ ]]; then
        echo "âŒ å·²å–æ¶ˆ"
        exit 0
    fi
fi

export VIBE_SKIP_ATTACH=1
export VIBE_NON_INTERACTIVE=$NON_INTERACTIVE
export VIBE_FORCE_RECREATE=1
export VIBE_ASSUME_YES=$AUTO_YES

LAYOUT_SCRIPT="$(layout_script_path "$PLAN_LAYOUT")"

"$LAYOUT_SCRIPT" "$PROJECT_DIR"

SESSION_NAME="$(layout_session_name "$PLAN_LAYOUT")"

# ç­‰å¾… tmux å®Œæˆå»ºç«‹
sleep 0.3

send_tmux_commands "$SESSION_NAME"

tmux attach-session -t "$SESSION_NAME"
